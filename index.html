<!DOCTYPE html><html lang="es"><head>  <meta charset="UTF-8">  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">  <meta name="theme-color" content="#2563eb">  <meta name="description" content="Sistema de gesti贸n de cotizaciones y reportes para Electromotores Santana. Aplicaci贸n web progresiva optimizada para dispositivos m贸viles.">  <!-- PWA Meta Tags -->  <meta name="apple-mobile-web-app-capable" content="yes">  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">  <meta name="apple-mobile-web-app-title" content="EMS">  <meta name="mobile-web-app-capable" content="yes">  <!-- Security Meta Tags -->  <meta http-equiv="X-UA-Compatible" content="IE=edge">  <meta name="referrer" content="strict-origin-when-cross-origin">  <!-- Performance Hints -->  <meta http-equiv="x-dns-prefetch-control" content="on">  <title>EMS - Electromotores Santana</title>  <!-- Styles -->  <link rel="stylesheet" href="styles.css">  <!-- PWA Manifest -->  <link rel="manifest" href="manifest.json">  <!-- Icons -->  <link rel="icon" type="image/png" href="./icons/icon-192.png" sizes="192x192">  <link rel="apple-touch-icon" href="./icons/icon-192.png">  <link rel="shortcut icon" href="./icons/icon-192.png">  <!-- External Libraries - SIN defer para que carguen antes -->  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app-check.js"></script>  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />  <!-- Preconnect and DNS Prefetch for Performance -->  <link rel="preconnect" href="https://www.gstatic.com" crossorigin>  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>  <link rel="preconnect" href="https://firestore.googleapis.com">  <link rel="preconnect" href="https://res.cloudinary.com">  <link rel="dns-prefetch" href="https://www.gstatic.com">  <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com"></head><body>  <!-- Network Status Indicator -->  <div id="network-status" class="ems-network-status" role="alert" aria-live="polite">    <span class="status-text"></span>  </div>  <!-- Splash Screen Minimalista -->  <div id="splash-screen" style="position:fixed;inset:0;background:#2563eb;display:flex;align-items:center;justify-content:center;z-index:10000;transition:opacity 0.3s;">    <div style="text-align:center;color:white;">      <div style="width:96px;height:96px;margin:0 auto 20px;background:white;border-radius:12px;display:flex;align-items:center;justify-content:center;box-shadow:0 10px 25px rgba(0,0,0,0.2);">        <img src="./icons/icon-192.png" alt="EMS Logo" style="width:80px;height:80px;border-radius:8px;">      </div>      <h1 style="margin:0;font-size:2em;font-weight:700;">EMS</h1>      <p style="margin:12px 0 0;opacity:0.95;font-size:1em;font-weight:400;">Electromotores Santana</p>      <div style="width:40px;height:3px;background:rgba(255,255,255,0.5);margin:16px auto 0;border-radius:2px;"></div>    </div>  </div>  <!-- Main App Container -->  <div id="root"></div>  <!-- Progress Bar -->  <div id="progress-bar" style="display:none;"></div>  <!-- Main App Script -->  <script src="app.js"></script>  <!-- Firebase & Service Worker Initialization -->  <script>    // Hide splash screen when app loads    window.addEventListener('load', function() {      setTimeout(function() {        const splash = document.getElementById('splash-screen');        if (splash) {          splash.style.opacity = '0';          setTimeout(function() {            splash.style.display = 'none';          }, 300);        }      }, 800);    });    // Firebase App Check    try {      if (firebase && firebase.app) {        firebase.appCheck().activate('TU_RECAPTCHA_V3_SITE_KEY', true);      }    } catch (e) {      console.warn('App Check not configured:', e);    }        // Back handler: no salir de la app, volver al inicio    (function(){      try {        if (!history.state || !history.state.ems) history.replaceState({ems:'root'}, '');        window.addEventListener('popstate', function(e){          e.preventDefault();          try { if (typeof renderInicio === 'function') renderInicio(); } catch {}          history.replaceState({ems:'root'}, '');        });      } catch {}    })();    // Recordatorios espordicos    (function(){      if (!('Notification' in window)) return;      try { Notification.requestPermission().catch(()=>{}); } catch {}      function countPendientes(){        let n = 0; try { if (localStorage.getItem('EMS_COT_BORRADOR')) n++; } catch {}        try { if (localStorage.getItem('EMS_REP_BORRADOR')) n++; } catch {}        return n;      }      function remind(){        const n = countPendientes();        if (n>0 && Notification.permission==='granted'){          try { new Notification('Tienes pendientes', { body: Hay  pendientes por terminar., icon: './icons/icon-192.png' }); } catch {}        }      }      setInterval(remind, 1000*60*60*6); // cada 6 horas      setTimeout(remind, 1000*30);    })();// Service Worker Registration with Update Detection    if ('serviceWorker' in navigator) {      window.addEventListener('load', function() {        // Solo usar versi贸n, NO timestamp (evita updates falsos)        navigator.serviceWorker.register('./service-worker.js?v=41')          .then(function(registration) {            console.log('SW registered:', registration.scope);            // Check for updates solo una vez al cargar            registration.update().catch(() => {});            // Notify on SW update (solo cuando realmente hay uno nuevo)            registration.addEventListener('updatefound', () => {              const newWorker = registration.installing;              if (!newWorker) return;              newWorker.addEventListener('statechange', () => {                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {                  // Verificar que realmente es un update (no la primera instalaci贸n)                  if (typeof showToast === 'function') {                    showToast('Nueva versi贸n disponible. Recarga para actualizar.', 'info', 8000);                  }                }              });            });          })          .catch(function(error) {            console.error('SW registration failed:', error);          });      });    }    // Auto-expand textareas for comfortable typing (works with dynamic forms)    (function(){      function autosize(el){        try { el.style.height = 'auto'; el.style.height = (el.scrollHeight)+'px'; } catch {}      }      function attach(el){        if (!el || el.__ems_auto) return; el.__ems_auto = true; autosize(el);        el.addEventListener('input', function(){ autosize(el); });      }      function scan(){ document.querySelectorAll('textarea').forEach(attach); }      document.addEventListener('input', function(e){ if (e.target && e.target.tagName==='TEXTAREA') attach(e.target); }, true);      const mo = new MutationObserver(scan); mo.observe(document.documentElement, { childList:true, subtree:true });      window.addEventListener('load', scan);    })();  </script></body></html>